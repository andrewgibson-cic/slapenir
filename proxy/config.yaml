# Universal API Credential Injector - Configuration File
#
# This file defines the strategies and rules for credential injection.
# Copy this to config.yaml and fill in your real credentials.

# Strategy Definitions
# Each strategy defines how to authenticate with a specific service or protocol
strategies:
  # AWS SigV4 Strategy for Production
  - name: aws-prod
    type: aws_sigv4
    config:
      # Credentials can be direct values or environment variable names
      access_key_id: AWS_ACCESS_KEY_ID        # Read from env var
      secret_access_key: AWS_SECRET_ACCESS_KEY # Read from env var
      session_token: AWS_SESSION_TOKEN         # Optional, for temporary creds
      region: us-east-1                        # Default region
      allowed_hosts:
        - "*.amazonaws.com"
        - "*.amazonaws.com.cn"
  
  # AWS SigV4 Strategy for Development (different credentials)
  - name: aws-dev
    type: aws_sigv4
    config:
      access_key_id: AWS_DEV_ACCESS_KEY_ID
      secret_access_key: AWS_DEV_SECRET_ACCESS_KEY
      region: us-west-2
      allowed_hosts:
        - "*.amazonaws.com"
  
  # Stripe API Strategy
  - name: stripe-live
    type: stripe  # Specialized Bearer strategy
    config:
      token: STRIPE_SECRET_KEY  # Read from env var
  
  # GitHub API Strategy
  - name: github-personal
    type: github  # Specialized Bearer strategy
    config:
      token: GITHUB_TOKEN  # Read from env var
  
  # OpenAI API Strategy
  - name: openai
    type: openai  # Specialized Bearer strategy
    config:
      token: OPENAI_API_KEY  # Read from env var
  
  # Google Gemini API Strategy
  - name: gemini
    type: gemini  # Specialized strategy for Google Gemini
    config:
      api_key: GEMINI_API_KEY  # Read from env var
  
  # Generic Bearer Token Strategy Example
  - name: custom-api
    type: bearer
    config:
      token: CUSTOM_API_TOKEN
      dummy_pattern: "DUMMY_CUSTOM_TOKEN"
      allowed_hosts:
        - "api.example.com"
        - "*.example.com"
  
  # Slack Bot Token API Strategy
  - name: slack-bot
    type: bearer
    config:
      token: SLACK_BOT_TOKEN  # Note: .env uses SLACK_BOT_TOKEN (no REAL_ prefix)
      dummy_pattern: "xoxb-DUMMY"
      allowed_hosts:
        - "slack.com"
        - "*.slack.com"
  
  # Slack App Token API Strategy
  - name: slack-app
    type: bearer
    config:
      token: SLACK_APP_TOKEN  # Note: .env uses SLACK_APP_TOKEN (no REAL_ prefix)
      dummy_pattern: "xapp-DUMMY"
      allowed_hosts:
        - "slack.com"
        - "*.slack.com"
  
  # IBM OpenAI-Compatible API Strategy (for Aider bot)
  - name: ibm-openai
    type: ibm_openai
    config:
      api_key: IBM_API_KEY
      base_url: IBM_BASE_URL
      dummy_pattern: "DUMMY_IBM_KEY"
      allowed_hosts:
        - "servicesessentials.ibm.com"
        - "*.ibm.com"
  
  # Cline IBM ICA API Strategy
  - name: ica-cline
    type: bearer
    config:
      token: ICA_API_KEY  # Note: .env uses ICA_API_KEY (no REAL_ prefix)
      dummy_pattern: "DUMMY_ICA_KEY"
      allowed_hosts:
        - "servicesessentials.ibm.com"
        - "*.ica.ibm.com"
  
  # Semantic Scholar API Strategy
  - name: semantic-scholar
    type: bearer
    config:
      token: S2_API_KEY  # Read from env var
      dummy_pattern: "DUMMY_S2_API_KEY"
      allowed_hosts:
        - "api.semanticscholar.org"
        - "*.semanticscholar.org"

# Injection Rules
# Rules define when to apply each strategy based on request characteristics
rules:
  # AWS Production Rule
  - name: aws-prod-injection
    # Match requests to AWS endpoints
    domain_regex: ".*\\.amazonaws\\.com$"
    # With dummy AWS credentials in headers
    trigger_header_regex: "AKIA[0-9A-Z]{16}DUMMY"
    # Apply the aws-prod strategy
    strategy: aws-prod
    priority: 100
  
  # AWS Development Rule (higher priority for specific dev pattern)
  - name: aws-dev-injection
    domain_regex: ".*\\.amazonaws\\.com$"
    trigger_header_regex: "AKIA00000000DEVKEY"
    strategy: aws-dev
    priority: 110  # Higher priority = evaluated first
  
  # Stripe Rule
  - name: stripe-injection
    domain_regex: "^(api\\.)?stripe\\.com$"
    trigger_header_regex: "sk_(test|live)_00000000"
    strategy: stripe-live
    priority: 100
  
  # GitHub Rule
  - name: github-injection
    domain_regex: "^(api\\.)?github\\.com$"
    trigger_header_regex: "(ghp_[a-zA-Z0-9]{36}DUMMY|DUMMY_GITHUB_TOKEN)"
    strategy: github-personal
    priority: 100
  
  # OpenAI Rule
  - name: openai-injection
    domain_regex: "^api\\.openai\\.com$"
    trigger_header_regex: "(sk-proj-[a-zA-Z0-9]{32}DUMMY|DUMMY_OPENAI_KEY)"
    strategy: openai
    priority: 100
  
  # Google Gemini Rule
  - name: gemini-injection
    domain_regex: "^(.*\\.)?googleapis\\.com$"
    trigger_header_regex: "(AIza[a-zA-Z0-9_-]{35}DUMMY|DUMMY_GEMINI_KEY)"
    strategy: gemini
    priority: 100
  
  # Slack Bot Token Rule
  - name: slack-bot-injection
    domain_regex: "^(.*\\.)?slack\\.com$"
    trigger_header_regex: "xoxb-DUMMY"
    strategy: slack-bot
    priority: 100
  
  # Slack App Token Rule
  - name: slack-app-injection
    domain_regex: "^(.*\\.)?slack\\.com$"
    trigger_header_regex: "xapp-DUMMY"
    strategy: slack-app
    priority: 100
  
  # IBM OpenAI-Compatible API Rule (for Aider bot)
  - name: ibm-openai-injection
    domain_regex: "^(.*\\.)?ibm\\.com$"
    trigger_header_regex: "DUMMY_IBM_KEY"
    strategy: ibm-openai
    priority: 110  # Higher priority than generic ICA rule
  
  # Cline IBM ICA Rule
  - name: cline-ica-injection
    domain_regex: "^(.*servicesessentials\\.ibm\\.com|.*\\.ica\\.ibm\\.com)$"
    trigger_header_regex: "DUMMY_ICA_KEY"
    strategy: ica-cline
    priority: 100
  
  # Semantic Scholar Rule
  - name: semantic-scholar-injection
    domain_regex: "^(.*\\.)?semanticscholar\\.org$"
    trigger_header_regex: "DUMMY_S2_API_KEY"
    strategy: semantic-scholar
    priority: 100

# Global Settings
settings:
  # Logging configuration
  log_level: DEBUG  # DEBUG, INFO, WARNING, ERROR
  log_format: json  # json or text
  
  # Security settings
  fail_mode: closed  # closed (drop on error) or open (pass through on error)
  
  # Performance settings
  max_body_size_mb: 100  # Maximum body size to process (larger uses streaming)
  
  # Telemetry blocking (optional)
  block_telemetry: true
  telemetry_domains:
    - "telemetry.anthropic.com"
    - "sentry.io"
    - "*.sentry.io"
    - "analytics.google.com"
    - "*.segment.com"
    - "*.mixpanel.com"
    - "*.amplitude.com"
    - "api.cline.bot"
    - "*.cline.bot"
